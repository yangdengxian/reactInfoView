'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.appMiddleware = undefined;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _server = require('react-dom/server');

var _server2 = _interopRequireDefault(_server);

var _reactRouter = require('react-router');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var appMiddleware = exports.appMiddleware = function appMiddleware(routes, Template, templatePropsProvider) {

    function createResponse(props) {

        return '\n            <!doctype html>\n            ' + _server2.default.renderToString(_react2.default.createElement(Template, props)) + '\n        ';
    }

    return function (req, res) {
        (0, _reactRouter.match)({ routes: routes, location: req.url }, function (error, redirectLocation, renderProps) {
            if (redirectLocation) {
                res.status(301).redirect(redirectLocation.pathname + redirectLocation.search);
            } else if (error) {
                res.status(500).send(error.message);
            } else if (renderProps === null) {
                res.status(404).send('Not found');
            } else {
                var templateProps = templatePropsProvider(renderProps, req, res);
                res.status(200).send(createResponse(templateProps));
            }
        });
    };
};